# StepFlow Gateway шодшпБч│╗ч╗ЯцА╗ч╗У

## ЁЯОп шодшпБч│╗ч╗ЯхоМцХ┤цАзхИЖцЮР

ч╗Пш┐Зшпжч╗Жшо╛шобя╝МStepFlow Gateway чЪДшодшпБч│╗ч╗Ях╖▓ч╗ПшАГшЩСф║Ж**хЕищЭвчЪДшодшпБщА╗ш╛С**я╝МхМЕцЛмя╝Ъ

### тЬЕ **х╖▓шАГшЩСчЪДшодшпБцЦ╣щЭв**

#### 1. API члпчВ╣шодшпБ (чЫоцаЗ API шодшпБ)
- **хдЪчзНшодшпБцЦ╣х╝П**: BasicуАБBearer TokenуАБAPI KeyуАБOAuth2уАБшЗкхоЪф╣ЙшодшпБ
- **шодшпБщЕНч╜очобчРЖ**: цпПф╕к API цЦЗцбгхПпф╗ецЬЙчЛмчлЛчЪДшодшпБщЕНч╜о
- **хЗнцНохоЙхЕихнШхВи**: хКахпЖхнШхВицХПцДЯшодшпБф┐бцБп
- **хКицАБхЗнцНо**: цФпцМБш┐РшбМцЧ╢хКицАБшО╖хПЦшодшпБхЗнцНо
- **хЗнцНохИ╖цЦ░**: шЗкхКихИ╖цЦ░ш┐ЗцЬЯчЪДшодшпБхЗнцНо

#### 2. Gateway чФицИ╖шодшпБ (Gateway шЗкш║лшодшпБ)
- **чФицИ╖чобчРЖ**: чФицИ╖ц│ихЖМуАБчЩ╗х╜ХуАБцЭГщЩРчобчРЖ
- **хпЖчаБхоЙхЕи**: хпЖчаБхУИх╕МуАБчЫРхА╝уАБхоЙхЕищкМшпБ
- **ф╝ЪшпЭчобчРЖ**: ф╝ЪшпЭф╗дчЙМуАБхИ╖цЦ░ф╗дчЙМуАБш┐ЗцЬЯчобчРЖ
- **шзТшЙ▓цЭГщЩР**: чобчРЖхСШуАБцЩощАЪчФицИ╖уАБAPI чФицИ╖чнЙшзТшЙ▓

#### 3. шодшпБч╝УхнШцЬ║хИ╢
- **цАзшГ╜ф╝ШхМЦ**: ч╝УхнШшодшпБф┐бцБпя╝МхЗПх░СщЗНхдНшодшпБ
- **ч╝УхнШш┐ЗцЬЯ**: шЗкхКичобчРЖч╝УхнШш┐ЗцЬЯцЧ╢щЧ┤
- **ч╝УхнШч▒╗хЮЛ**: цФпцМБф╗дчЙМуАБф╝ЪшпЭуАБхЗнцНочнЙхдЪчзНч╝УхнШ

#### 4. шодшпБчЫСцОзхТМхобшоб
- **шодшпБцЧех┐Ч**: шо░х╜ХцЙАцЬЙшодшпБх░ЭшпХхТМч╗УцЮЬ
- **хд▒ш┤ечЫСцОз**: чЫСцОзшодшпБхд▒ш┤ецГЕхЖ╡
- **цАзшГ╜ч╗Яшоб**: шодшпБхУНх║ФцЧ╢щЧ┤ч╗Яшоб
- **хоЙхЕихобшоб**: хоМцХ┤чЪДшодшпБхобшобцЧех┐Ч

## ЁЯУК шодшпБчЫ╕хЕ│цХ░цНох║Ушби

### ца╕х┐ГшодшпБшби (6ф╕кшби)

| шбихРН | чФищАФ | хЕ│щФохКЯшГ╜ |
|------|------|----------|
| `api_auth_configs` | API шодшпБщЕНч╜о | хнШхВицпПф╕к API чЪДшодшпБцЦ╣х╝ПхТМщЕНч╜о |
| `auth_credentials` | шодшпБхЗнцНо | хнШхВихКахпЖчЪДшодшпБхЗнцНоф┐бцБп |
| `auth_cache` | шодшпБч╝УхнШ | ч╝УхнШшодшпБф┐бцБпя╝МцПРщлШцАзшГ╜ |
| `auth_logs` | шодшпБцЧех┐Ч | шо░х╜ХшодшпБх░ЭшпХхТМч╗УцЮЬ |
| `gateway_users` | Gateway чФицИ╖ | Gateway шЗкш║лчЪДчФицИ╖чобчРЖ |
| `gateway_sessions` | чФицИ╖ф╝ЪшпЭ | чобчРЖчФицИ╖чЩ╗х╜Хф╝ЪшпЭ |

### хЕ│шБФшби (6ф╕кшби)

| шбихРН | чФищАФ | шодшпБхЕ│шБФ |
|------|------|----------|
| `openapi_templates` | OpenAPI цибцЭ┐ | хнШхВи API цЦЗцбг |
| `api_documents` | API цЦЗцбг | хЕ│шБФшодшпБщЕНч╜о |
| `api_endpoints` | API члпчВ╣ | цЙзшбМшодшпБчЪДчлпчВ╣ |
| `api_call_logs` | HTTP цЧех┐Ч | шо░х╜ХшодшпБчЫ╕хЕ│чЪДшп╖ц▒В |
| `resource_references` | ш╡Дц║Рх╝ХчФи | х╖еф╜Ьц╡Бф╕нчЪД API ш░ГчФи |
| `api_health_checks` | хБех║╖цгАцЯе | цгАцЯе API хПпчФицАз |

## ЁЯФР цФпцМБчЪДшодшпБцЦ╣х╝П

### 1. Basic шодшпБ
```json
{
  "auth_type": "basic",
  "auth_config": {
    "username": "api_user",
    "password": "encrypted_password"
  }
}
```

### 2. Bearer Token шодшпБ
```json
{
  "auth_type": "bearer",
  "auth_config": {
    "token": "encrypted_token",
    "prefix": "Bearer",
    "header_name": "Authorization"
  }
}
```

### 3. API Key шодшпБ
```json
{
  "auth_type": "api_key",
  "auth_config": {
    "key_name": "X-API-Key",
    "key_value": "encrypted_api_key",
    "location": "header"
  }
}
```

### 4. OAuth2 шодшпБ
```json
{
  "auth_type": "oauth2",
  "auth_config": {
    "grant_type": "client_credentials",
    "token_url": "https://auth.example.com/oauth/token",
    "client_id": "encrypted_client_id",
    "client_secret": "encrypted_client_secret"
  }
}
```

### 5. хКицАБшодшпБ
```json
{
  "auth_type": "dynamic",
  "auth_config": {
    "provider": "vault",
    "path": "secret/api-credentials",
    "refresh_interval": 3600
  }
}
```

## ЁЯФД шодшпБц╡БчиЛшо╛шоб

### API ш░ГчФишодшпБц╡БчиЛ
```
1. цОецФ╢ API ш░ГчФишп╖ц▒В
    тЖУ
2. цЯецЙ╛хп╣х║ФчЪД API члпчВ╣
    тЖУ
3. цгАцЯецШпхРжщЬАшжБшодшпБ
    тЖУ
4. шО╖хПЦшодшпБщЕНч╜о
    тЖУ
5. цгАцЯешодшпБч╝УхнШ
    тЖУ
6. цЙзшбМшодшпБщА╗ш╛С
    тЖУ
7. цЫ┤цЦ░шодшпБч╝УхнШ
    тЖУ
8. ш╜мхПСшп╖ц▒ВхИ░чЫоцаЗ API
    тЖУ
9. шо░х╜ХшодшпБцЧех┐Ч
```

### хКицАБшодшпБхИ╖цЦ░ц╡БчиЛ
```
1. цгАцЯешодшпБхЗнцНоцШпхРжхН│х░Жш┐ЗцЬЯ
    тЖУ
2. ш░ГчФишодшпБцПРф╛ЫшАЕшО╖хПЦцЦ░хЗнцНо
    тЖУ
3. цЫ┤цЦ░шодшпБч╝УхнШ
    тЖУ
4. шо░х╜ХхИ╖цЦ░цЧех┐Ч
    тЖУ
5. ш┐ФхЫЮцЦ░хЗнцНо
```

## ЁЯЫбя╕П хоЙхЕишАГшЩС

### 1. цХ░цНохКахпЖ
- тЬЕ цХПцДЯцХ░цНохКахпЖхнШхВи
- тЬЕ ф╝аш╛УцХ░цНохКахпЖ
- тЬЕ хпЖщТечобчРЖ

### 2. хпЖчаБхоЙхЕи
- тЬЕ хпЖчаБхУИх╕М (bcrypt)
- тЬЕ хпЖчаБчЫРхА╝
- тЬЕ хпЖчаБхдНцЭВх║жщкМшпБ

### 3. ф╗дчЙМхоЙхЕи
- тЬЕ JWT ф╗дчЙМчн╛хРН
- тЬЕ ф╗дчЙМш┐ЗцЬЯчобчРЖ
- тЬЕ ф╗дчЙМхИ╖цЦ░цЬ║хИ╢

### 4. шо┐щЧоцОзхИ╢
- тЬЕ хЯ║ф║ОшзТшЙ▓чЪДцЭГщЩРцОзхИ╢
- тЬЕ ч╗Жч▓Тх║жцЭГщЩРчобчРЖ
- тЬЕ ф╝ЪшпЭчобчРЖ

## ЁЯУИ шодшпБчЫСцОзхКЯшГ╜

### 1. шодшпБч╗ЯшобшзЖхЫ╛
```sql
CREATE VIEW auth_statistics AS
SELECT 
    ac.auth_type,
    COUNT(al.id) as total_attempts,
    SUM(CASE WHEN al.auth_status = 'success' THEN 1 ELSE 0 END) as success_count,
    SUM(CASE WHEN al.auth_status = 'failed' THEN 1 ELSE 0 END) as failure_count,
    AVG(al.response_time_ms) as avg_response_time
FROM api_auth_configs ac
LEFT JOIN auth_logs al ON ac.id = al.auth_config_id
GROUP BY ac.auth_type;
```

### 2. шодшпБхд▒ш┤ечЫСцОз
```sql
CREATE VIEW auth_failures AS
SELECT 
    al.auth_type,
    al.error_message,
    COUNT(*) as failure_count,
    MAX(al.created_at) as last_failure
FROM auth_logs al
WHERE al.auth_status = 'failed'
GROUP BY al.auth_type, al.error_message
ORDER BY failure_count DESC;
```

## ЁЯФз хоЮчО░цЮ╢цЮД

### 1. шодшпБчобчРЖхЩи
```python
class AuthenticationManager:
    def get_auth_config(self, api_document_id: str) -> dict
    def authenticate_request(self, request_data: dict, auth_config: dict) -> dict
    def refresh_credentials(self, auth_config_id: str) -> dict
    def cache_auth_info(self, key: str, value: dict, expires_in: int)
```

### 2. шодшпБцПРф╛ЫшАЕцОехПг
```python
class AuthProvider(ABC):
    def authenticate(self, config: dict) -> dict
    def refresh(self, config: dict) -> dict
    def validate(self, credentials: dict) -> bool
```

### 3. хЕ╖ф╜УшодшпБцПРф╛ЫшАЕ
- `BasicAuthProvider` - Basic шодшпБ
- `BearerAuthProvider` - Bearer Token шодшпБ
- `ApiKeyAuthProvider` - API Key шодшпБ
- `OAuth2AuthProvider` - OAuth2 шодшпБ
- `DynamicAuthProvider` - хКицАБшодшпБ

## ЁЯУЛ шодшпБч│╗ч╗ЯцгАцЯец╕ЕхНХ

### хЯ║чбАшодшпБхКЯшГ╜ тЬЕ
- [x] хдЪчзНшодшпБцЦ╣х╝ПцФпцМБ
- [x] шодшпБщЕНч╜очобчРЖ
- [x] хЗнцНохоЙхЕихнШхВи
- [x] шодшпБч╝УхнШцЬ║хИ╢

### щлШч║зшодшпБхКЯшГ╜ тЬЕ
- [x] хКицАБшодшпБхЗнцНо
- [x] шЗкхКихЗнцНохИ╖цЦ░
- [x] Gateway чФицИ╖шодшпБ
- [x] ф╝ЪшпЭчобчРЖ

### хоЙхЕихКЯшГ╜ тЬЕ
- [x] цХПцДЯцХ░цНохКахпЖ
- [x] хпЖчаБхоЙхЕихУИх╕М
- [x] ф╗дчЙМхоЙхЕичФЯцИР
- [x] шодшпБцЧех┐Чхобшоб

### чЫСцОзхКЯшГ╜ тЬЕ
- [x] шодшпБч╗Яшоб
- [x] хд▒ш┤ечЫСцОз
- [x] цАзшГ╜чЫСцОз
- [x] хоЙхЕихобшоб

## ЁЯОп шодшпБч│╗ч╗Яф╝ШхК┐

### 1. хЕищЭвцАз
- цФпцМБцЙАцЬЙх╕╕шзБчЪДшодшпБцЦ╣х╝П
- шжЖчЫЦ API шодшпБхТМ Gateway шодшпБ
- хМЕхРлчЫСцОзхТМхобшобхКЯшГ╜

### 2. хоЙхЕицАз
- цХПцДЯцХ░цНохКахпЖхнШхВи
- хоЙхЕичЪДхпЖчаБхТМф╗дчЙМчобчРЖ
- хоМцХ┤чЪДхобшобцЧех┐Ч

### 3. чБ╡ц┤╗цАз
- цФпцМБхКицАБшодшпБщЕНч╜о
- хПпцЙйх▒ХчЪДшодшпБцПРф╛ЫшАЕцЮ╢цЮД
- чБ╡ц┤╗чЪДцЭГщЩРчобчРЖ

### 4. хПпшзВц╡ЛцАз
- шпжч╗ЖчЪДшодшпБцЧех┐Ч
- хоЮцЧ╢чЫСцОзхТМч╗Яшоб
- хд▒ш┤ехИЖцЮРхТМхСКшнж

## ЁЯТб ф╜┐чФих╗║шоо

### 1. ц╕Рш┐Ых╝ПхоЮчО░
1. хЕИхоЮчО░хЯ║чбАчЪД Bearer Token хТМ API Key шодшпБ
2. ц╖╗хКашодшпБч╝УхнШцЬ║хИ╢
3. хоЮчО░хКицАБшодшпБхТМшЗкхКихИ╖цЦ░
4. ц╖╗хКахоМцХ┤чЪДчЫСцОзхТМхобшоб

### 2. хоЙхЕицЬАф╜│хоЮш╖╡
1. ф╜┐чФих╝║хКахпЖчоЧц│Х
2. хоЪцЬЯш╜оцНвшодшпБхЗнцНо
3. чЫСцОзшодшпБхд▒ш┤ецГЕхЖ╡
4. хоЮцЦ╜цЬАх░ПцЭГщЩРхОЯхИЩ

### 3. цАзшГ╜ф╝ШхМЦ
1. хРИчРЖф╜┐чФишодшпБч╝УхнШ
2. х╝ВцнехдДчРЖшодшпБхИ╖цЦ░
3. ф╝ШхМЦшодшпБцЧех┐ЧхнШхВи
4. хоЪцЬЯц╕ЕчРЖш┐ЗцЬЯцХ░цНо

---

## цА╗ч╗У

StepFlow Gateway чЪДшодшпБч│╗ч╗Яшо╛шоб**щЭЮх╕╕хЕищЭв**я╝МшАГшЩСф║Жя╝Ъ

1. **хдЪчзНшодшпБцЦ╣х╝П** - цФпцМБцЙАцЬЙх╕╕шзБчЪД API шодшпБцЦ╣х╝П
2. **хоЙхЕихнШхВи** - хКахпЖхнШхВицЙАцЬЙцХПцДЯф┐бцБп
3. **хКицАБшодшпБ** - цФпцМБш┐РшбМцЧ╢хКицАБшО╖хПЦхТМхИ╖цЦ░хЗнцНо
4. **Gateway шодшпБ** - Gateway шЗкш║лчЪДчФицИ╖шодшпБхТМф╝ЪшпЭчобчРЖ
5. **чЫСцОзхобшоб** - хоМцХ┤чЪДшодшпБчЫСцОзхТМхобшобхКЯшГ╜
6. **цАзшГ╜ф╝ШхМЦ** - шодшпБч╝УхнШхТМх╝ВцнехдДчРЖ
7. **цЙйх▒ХцАз** - хПпцЙйх▒ХчЪДшодшпБцПРф╛ЫшАЕцЮ╢цЮД

ш┐Щф╕кшодшпБч│╗ч╗ЯхПпф╗ец╗бш╢│ф╝Бф╕Ъч║зх║ФчФичЪДцЙАцЬЙшодшпБщЬАц▒Вя╝МцПРф╛Ыф║ЖхоЙхЕиуАБхПпщЭауАБхПпшзВц╡ЛчЪДшодшпБшзгхЖ│цЦ╣цбИуАВ 